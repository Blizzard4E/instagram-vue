{"remainingRequest":"/home/starscream97/Documents/Instagram/insta/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/starscream97/Documents/Instagram/insta/src/views/Home.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/starscream97/Documents/Instagram/insta/src/views/Home.vue","mtime":1553270100365},{"path":"/home/starscream97/Documents/Instagram/insta/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/starscream97/Documents/Instagram/insta/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/starscream97/Documents/Instagram/insta/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/starscream97/Documents/Instagram/insta/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport axios from 'axios'\nimport Sidebar from '@/components/Sidebar'\nimport Vue from 'vue'\n\nexport default {\n  name: \"home\",\n  components:{\n    Sidebar\n  },\n  data(){\n    return{\n      isLoaded:false,\n      newPostsAvailable:false,\n      perPage:4,\n      page:1,\n      totalPages:1,\n      posts:[],\n      root_url:process.env.VUE_APP_ROOT_API,\n      newcomment:'',\n      user:JSON.parse(localStorage.getItem('user')),\n      morePostsAvailable:true\n    }\n  },\n sockets:{\n   someonePosted(data){\n     this.newPostsAvailable=true;\n     this.posts.unshift(data);\n   }\n },\n  methods:{\n    fetchAllPosts(){\n      axios.get(`${process.env.VUE_APP_ROOT_API}api/post?perPage=${this.perPage}&page=${this.page}`).then(res=>{\n        this.posts=res.data.data.docs;\n        this.totalPages=res.data.data.pages\n        // console.log(this.totalPages)\n        this.isLoaded=true;\n      })\n    },\n    loadMorePosts(){\n      this.page++;\n      if(this.page<=this.totalPages){\n          axios.get(`${process.env.VUE_APP_ROOT_API}api/post?perPage=${this.perPage}&page=${this.page}`).then(res=>{\n            // console.log(res.data.data.docs);\n            res.data.data.docs.forEach(post=>{\n              this.posts.push(post);\n            })\n          })       \n      }\n      if(this.page==this.totalPages){\n        this.morePostsAvailable=false;\n      }\n      \n    },\n    goToPhoto(photoURL){\n      window.open(`${this.root_url}${photoURL}`, \"_blank\");   \n    },\n    goToUserProfile(username){\n      this.$router.push({name:'userprofile',params:{username}});\n    },\n    viewPost(postId){\n      this.$router.push({name:'singlePost',params:{postId}});\n    },\n  \n    likePost(postId){\n      // const userId=JSON.parse(localStorage.getItem('user')).userId;\n      axios.post(`${process.env.VUE_APP_ROOT_API}api/post/like`,{\n        userId:this.userId,\n        postId\n      })\n    },\n    commentOnPost(postIndex,postId,receiverId,pictureURL){\n      // this.posts[postIndex].comments.push(this.comment);\n      axios.post(`${process.env.VUE_APP_ROOT_API}api/comment/comment`,{\n        userId:this.user.userId,\n        comment:this.newcomment,\n        commenterName:this.user.name,\n        postId\n      }).then(res=>{\n        this.newcomment=''\n        this.fetchAllPosts();\n        this.$forceUpdate();\n      })\n      this.$socket.emit('notification',{postId,comment:this.newcomment,notificationType:\"Comment\",to:receiverId,pictureURL,userId:this.$store.state.user.userId,username:this.$store.state.user.name});      \n    }\n  },\n  created(){\n    console.log(process.env.VUE_APP_ROOT_API)\n    this.fetchAllPosts();\n    const user=JSON.parse(localStorage.getItem('user'));\n    if(user && user.userId!==''){\n        this.$store.commit('setUser',user);\n        this.$socket.emit('newUser',{userId:user.userId,},function(data){\n        });\n    }\n  },\n};\n",{"version":3,"sources":["Home.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Home.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"home container\">\n    <div class=\"posts\" v-if=\"isLoaded\">\n    <div class=\"new-post-alert\" v-if=\"newPostsAvailable\">New Posts</div>\n      \n      <div class=\"post\" v-for=\"(post,index) in posts\" :key=\"post._id\">\n        <div class=\"post-author\">\n          <h5 @click=\"goToUserProfile(post.user.username)\">{{post.user.name}}</h5>\n          <h6>{{post.user.username}}</h6>\n        </div>\n        <div class=\"post-image\">\n          <img :src=\"root_url  + post.pictureURL\" alt=\"\" @click=\"viewPost(post._id)\">\n        </div>\n        <div class=\"post-body\">\n            <div class=\"react-buttons\">\n              <div class=\"like\"><i class=\"fas fa-heart\" @click.prevent=\"likePost(post._id)\"></i></div>\n              <div class=\"download\" @click.prevent=\"goToPhoto(post.pictureURL)\"><i class=\"fas fa-arrow-alt-circle-down\"></i></div>\n            </div>\n            <div class=\"post-description\">\n              <h4>{{post.title}}</h4>\n              <h6>{{post.likes}} likes</h6>\n            </div>\n            \n            <div class=\"comments\">\n              <div class=\"comment\" v-for=\"comment in post.comments.slice(0,4)\" :key=\"comment._id\">\n                <h5 class=\"commenter-name\">{{comment.commenterName}}</h5>\n                <h6 class=\"comment-text\">{{comment.comment}}</h6>\n              </div>\n            </div>\n            <div class=\"comment-form\">\n              <form action=\"\" @submit.prevent=\"commentOnPost(index,post._id,post.user._id,post.pictureURL)\">\n                <input type=\"text\" placeholder=\"Add a comment\" v-model=\"newcomment\">\n              </form>\n            </div>\n        </div>\n      </div>\n      <button v-if=\"morePostsAvailable\" @click.prevent=\"loadMorePosts()\" class=\"loadMorePostBtn\">Load More Post</button>\n    </div>\n    <div class=\"sidebar\">\n      <Sidebar />\n    </div>\n    \n  </div>\n</template>\n\n<script>\n\nimport axios from 'axios'\nimport Sidebar from '@/components/Sidebar'\nimport Vue from 'vue'\n\nexport default {\n  name: \"home\",\n  components:{\n    Sidebar\n  },\n  data(){\n    return{\n      isLoaded:false,\n      newPostsAvailable:false,\n      perPage:4,\n      page:1,\n      totalPages:1,\n      posts:[],\n      root_url:process.env.VUE_APP_ROOT_API,\n      newcomment:'',\n      user:JSON.parse(localStorage.getItem('user')),\n      morePostsAvailable:true\n    }\n  },\n sockets:{\n   someonePosted(data){\n     this.newPostsAvailable=true;\n     this.posts.unshift(data);\n   }\n },\n  methods:{\n    fetchAllPosts(){\n      axios.get(`${process.env.VUE_APP_ROOT_API}api/post?perPage=${this.perPage}&page=${this.page}`).then(res=>{\n        this.posts=res.data.data.docs;\n        this.totalPages=res.data.data.pages\n        // console.log(this.totalPages)\n        this.isLoaded=true;\n      })\n    },\n    loadMorePosts(){\n      this.page++;\n      if(this.page<=this.totalPages){\n          axios.get(`${process.env.VUE_APP_ROOT_API}api/post?perPage=${this.perPage}&page=${this.page}`).then(res=>{\n            // console.log(res.data.data.docs);\n            res.data.data.docs.forEach(post=>{\n              this.posts.push(post);\n            })\n          })       \n      }\n      if(this.page==this.totalPages){\n        this.morePostsAvailable=false;\n      }\n      \n    },\n    goToPhoto(photoURL){\n      window.open(`${this.root_url}${photoURL}`, \"_blank\");   \n    },\n    goToUserProfile(username){\n      this.$router.push({name:'userprofile',params:{username}});\n    },\n    viewPost(postId){\n      this.$router.push({name:'singlePost',params:{postId}});\n    },\n  \n    likePost(postId){\n      // const userId=JSON.parse(localStorage.getItem('user')).userId;\n      axios.post(`${process.env.VUE_APP_ROOT_API}api/post/like`,{\n        userId:this.userId,\n        postId\n      })\n    },\n    commentOnPost(postIndex,postId,receiverId,pictureURL){\n      // this.posts[postIndex].comments.push(this.comment);\n      axios.post(`${process.env.VUE_APP_ROOT_API}api/comment/comment`,{\n        userId:this.user.userId,\n        comment:this.newcomment,\n        commenterName:this.user.name,\n        postId\n      }).then(res=>{\n        this.newcomment=''\n        this.fetchAllPosts();\n        this.$forceUpdate();\n      })\n      this.$socket.emit('notification',{postId,comment:this.newcomment,notificationType:\"Comment\",to:receiverId,pictureURL,userId:this.$store.state.user.userId,username:this.$store.state.user.name});      \n    }\n  },\n  created(){\n    console.log(process.env.VUE_APP_ROOT_API)\n    this.fetchAllPosts();\n    const user=JSON.parse(localStorage.getItem('user'));\n    if(user && user.userId!==''){\n        this.$store.commit('setUser',user);\n        this.$socket.emit('newUser',{userId:user.userId,},function(data){\n        });\n    }\n  },\n};\n</script>\n"]}]}